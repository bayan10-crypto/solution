<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ó–∞—Ç—Ç–∞—Ä–¥—ã“£ —Å—É–¥–∞ –µ—Ä—É—ñ ‚Äî 3 –±–µ—Ç (—Å–∏–º—É–ª—è—Ü–∏—è ‚Ä¢ —à/–∂ ‚Ä¢ –±”ô–π–≥–µ)</title>
  <style>
    :root{
      --bg:#061424;
      --bg2:#061a33;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.14);
      --text:#eaf4ff;
      --muted:#a9c3de;
      --accent:#45d6ff;
      --accent2:#7bffb2;
      --good:#2ef7a1;
      --bad:#ff4d6d;
      --warn:#ffd166;
      --shadow:0 14px 40px rgba(0,0,0,.35);
      --r:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 540px at 18% 12%, rgba(69,214,255,.16), transparent 55%),
        radial-gradient(860px 560px at 82% 20%, rgba(123,255,178,.12), transparent 55%),
        radial-gradient(900px 600px at 55% 95%, rgba(255,209,102,.08), transparent 55%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }
    .chem-bg{
      position:fixed; inset:0; pointer-events:none;
      background-image:
        linear-gradient(90deg, rgba(255,255,255,.045) 1px, transparent 1px),
        linear-gradient(0deg, rgba(255,255,255,.045) 1px, transparent 1px);
      background-size: 120px 120px;
      opacity:.35;
    }

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(6,20,36,.60);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:44px;height:44px;border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:
        radial-gradient(circle at 35% 35%, rgba(69,214,255,.85), rgba(69,214,255,.18) 55%, transparent 60%),
        radial-gradient(circle at 70% 70%, rgba(123,255,178,.75), rgba(123,255,178,.14) 55%, transparent 62%),
        linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,0));
      box-shadow: var(--shadow);
    }
    h1{margin:0;font-size:16px;letter-spacing:.2px}
    .sub{margin:2px 0 0;color:var(--muted);font-size:12px}

    nav{display:flex;gap:10px;flex-wrap:wrap}
    .tab{
      text-decoration:none;color:var(--text);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      padding:10px 12px;border-radius:999px;font-size:13px;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      user-select:none;
    }
    .tab:hover{transform: translateY(-1px); border-color: rgba(69,214,255,.45);}
    .tab.active{
      background: linear-gradient(135deg, rgba(69,214,255,.22), rgba(123,255,178,.12));
      border-color: rgba(69,214,255,.55);
    }

    main{padding:18px 0 44px}
    .page{display:none}
    .page.active{display:block}

    .grid{display:grid;gap:16px}
    @media (min-width: 980px){
      .grid.cols-2{grid-template-columns: 1.1fr .9fr;}
      .grid.cols-3{grid-template-columns: 1fr 1fr 1fr;}
    }

    .card{
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.065), rgba(255,255,255,.045));
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:16px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute; right:-90px; top:-90px;
      width:220px; height:220px;
      background: radial-gradient(circle, rgba(69,214,255,.18), transparent 60%);
    }
    h2{margin:0 0 10px;font-size:18px}
    h3{margin:0 0 8px;font-size:14px;color:#f2f8ff}
    p{margin:0 0 10px}
    .muted{color:var(--muted)}
    .mono{font-family:var(--mono)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .chip{
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
    }

    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    label.small{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    select, input[type="range"]{width:100%}
    select{
      padding:10px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      color:var(--text);outline:none;
    }
    input[type="range"]{accent-color: var(--accent);}

    button{
      appearance:none;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      color:var(--text);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
      font-size:13px;
    }
    button:hover{transform: translateY(-1px); border-color: rgba(69,214,255,.45);}
    button.primary{
      background: linear-gradient(135deg, rgba(69,214,255,.22), rgba(123,255,178,.12));
      border-color: rgba(69,214,255,.55);
    }
    button.ghost{background: rgba(255,255,255,.06);}
    button.danger{background: rgba(255,77,109,.12); border-color: rgba(255,77,109,.40);}

    .panel{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      border-radius:14px;
      padding:12px;
    }

    .bar{height:10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background: rgba(255,255,255,.06);overflow:hidden;margin-top:8px}
    .fill{height:100%;width:0%;background: linear-gradient(90deg, rgba(69,214,255,.75), rgba(123,255,178,.65));transition: width .25s ease}

    .result{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      border-radius:14px;
      padding:12px;
      margin-top:12px;
      font-size:13px;
    }
    .ok{color:var(--good); font-weight:700}
    .bad{color:var(--bad); font-weight:700}
    .warn{color:var(--warn); font-weight:700}

    /* ===== Simulation beaker ===== */
    .lab{
      display:grid;gap:12px;
      grid-template-columns: 1fr;
    }
    @media (min-width:980px){
      .lab{grid-template-columns: 1fr 1fr;}
    }
    .beaker{
      width:100%;
      height:260px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
    }
    .beaker svg{position:absolute; inset:0; width:100%; height:100%;}
    .soluteDot{
      position:absolute;
      width:10px;height:10px;border-radius:4px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      opacity:.95;
      transform: translate(-50%,-50%);
      transition: opacity .25s ease, transform .25s ease;
    }
    .cloud{
      position:absolute; inset:auto 10% 18% 10%;
      height:64px;
      border-radius:18px;
      background: radial-gradient(circle at 30% 40%, rgba(69,214,255,.20), transparent 60%),
                  radial-gradient(circle at 65% 60%, rgba(123,255,178,.16), transparent 60%),
                  rgba(255,255,255,.02);
      border:1px solid rgba(255,255,255,.08);
      opacity:0;
      transition: opacity .35s ease;
      filter: blur(.2px);
    }
    .stir{
      position:absolute;
      left:50%; top:50%;
      width:160px; height:160px;
      border-radius:999px;
      border:1px dashed rgba(255,255,255,.12);
      transform: translate(-50%,-50%);
      opacity:.0;
      animation: spin 2.2s linear infinite;
    }
    @keyframes spin{
      from{transform: translate(-50%,-50%) rotate(0deg);}
      to{transform: translate(-50%,-50%) rotate(360deg);}
    }

    /* ===== True/False ===== */
    .tf-item{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius:14px;
      padding:12px;
      margin-bottom:10px;
    }
    .tf-head{
      display:flex; gap:10px; align-items:flex-start; justify-content:space-between;
      margin-bottom:10px;
    }
    .num{
      font-family:var(--mono);
      font-size:12px;
      padding:4px 8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(69,214,255,.10);
      white-space:nowrap;
    }
    .opt{
      display:flex; gap:10px; align-items:flex-start;
      padding:8px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      margin:8px 0;
      cursor:pointer;
      user-select:none;
    }
    .opt input{margin-top:2px}
    .pill{
      font-family:var(--mono);
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    /* ===== Horse race ===== */
    .raceTop{
      display:grid;
      gap:12px;
      grid-template-columns: 1fr;
    }
    .track{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.12);
      border-radius:16px;
      padding:12px;
      overflow:hidden;
      position:relative;
    }
    .lanes{display:grid; gap:10px;}
    .lane{
      position:relative;
      height:58px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:
        linear-gradient(90deg, rgba(255,255,255,.04), rgba(255,255,255,.02)),
        repeating-linear-gradient(90deg, rgba(255,255,255,.12) 0 2px, transparent 2px 60px);
      overflow:hidden;
    }
    .finish{
      position:absolute; top:0; bottom:0; right:14px;
      width:8px; border-radius:6px;
      background: repeating-linear-gradient(0deg, rgba(255,255,255,.55) 0 6px, rgba(0,0,0,.0) 6px 12px);
      opacity:.55;
    }
    .horse{
      position:absolute;
      left:8px; top:50%;
      transform: translateY(-50%);
      display:flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      box-shadow: 0 10px 20px rgba(0,0,0,.22);
      transition: left .25s ease;
      min-width:140px;
    }
    .horse .icon{
      width:28px;height:28px;border-radius:10px;
      border:1px solid rgba(255,255,255,.18);
      display:grid;place-items:center;
      background: radial-gradient(circle at 35% 35%, rgba(69,214,255,.20), rgba(0,0,0,.18));
      font-size:16px;
    }
    .horse .name{
      font-size:12px;
      color:rgba(232,242,255,.95);
      line-height:1.1;
    }
    .horse .name b{font-size:13px}
    .raceHUD{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between;
      margin-top:10px;
    }
    .raceHUD .pill{box-shadow:none}
    .raceGrid{
      display:grid; gap:16px;
      grid-template-columns: 1fr;
      margin-top:16px;
    }
    @media (min-width:980px){
      .raceGrid{grid-template-columns: 1fr 1fr;}
    }
    .teamBox{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
      border-radius:16px;
      padding:12px;
    }
    .teamBox h3{margin:0 0 6px}
    .teamMeta{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .qArea{margin-top:10px}
    .qText{margin:0; font-size:13px; line-height:1.35}
    .choiceWrap{margin-top:10px}
    .choiceWrap .opt{margin:8px 0}
    .locked{
      opacity:.9;
    }
    .footer{margin-top:14px;text-align:center;color:var(--muted);font-size:12px}
  </style>
</head>

<body>
  <div class="chem-bg" aria-hidden="true"></div>

  <header>
    <div class="wrap">
      <div class="top">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>–ó–∞—Ç—Ç–∞—Ä–¥—ã“£ —Å—É–¥–∞ –µ—Ä—É—ñ</h1>
            <div class="sub">1) –ê“õ–ø–∞—Ä–∞—Ç + —Å–∏–º—É–ª—è—Ü–∏—è ‚Ä¢ 2) –®—ã–Ω–¥—ã“õ/–ñ–∞–ª“ì–∞–Ω ‚Ä¢ 3) –ë”ô–π–≥–µ (4 —Ç–æ–ø)</div>
          </div>
        </div>

        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
          <a class="tab" href="#sim" data-page="sim">1-–±–µ—Ç: –°–∏–º—É–ª—è—Ü–∏—è</a>
          <a class="tab" href="#tf" data-page="tf">2-–±–µ—Ç: –®/–ñ</a>
          <a class="tab" href="#race" data-page="race">3-–±–µ—Ç: –ë”ô–π–≥–µ</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- ===== 1) SIMULATION ===== -->
    <section id="page-sim" class="page active">
      <div class="grid cols-2">
        <div class="card">
          <h2>–ñ–∞–ª–ø—ã –∞“õ–ø–∞—Ä–∞—Ç</h2>
          <p class="muted">
            <b>–ï—Ä—É</b> ‚Äî –∑–∞—Ç –±”©–ª—à–µ–∫—Ç–µ—Ä—ñ–Ω—ñ“£ (–º–æ–ª–µ–∫—É–ª–∞/–∏–æ–Ω) —Å—É –º–æ–ª–µ–∫—É–ª–∞–ª–∞—Ä—ã–º–µ–Ω ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å—ñ–ø,
            –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ–≥–µ –±—ñ—Ä–∫–µ–ª–∫—ñ —Ç–∞—Ä–∞–ª—É –ø—Ä–æ—Ü–µ—Å—ñ.
          </p>

          <div class="panel">
            <h3>–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω–∞ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω —Ñ–∞–∫—Ç–æ—Ä–ª–∞—Ä</h3>
            <div class="chips">
              <span class="chip">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ‚Üë</span>
              <span class="chip">–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É ‚Üë</span>
              <span class="chip">“∞–Ω—Ç–∞“õ—Ç–∞—É (–±–µ—Ç –∞—É–¥–∞–Ω—ã ‚Üë)</span>
              <span class="chip">–ó–∞—Ç —Ç–∞–±–∏“ì–∞—Ç—ã</span>
              <span class="chip">–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è</span>
            </div>
            <p class="muted" style="margin-top:10px">
              –ñ–∞–ª–ø—ã –∏–¥–µ—è: —Å—É –º–µ–Ω –µ—Ä—ñ–≥–µ–Ω –∑–∞—Ç –±”©–ª—à–µ–∫—Ç–µ—Ä—ñ –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã —Ç–∞—Ä—Ç—ã–ª—ã—Å/–≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è –∫“Ø—à—Ç—ñ –±–æ–ª—Å–∞,
              –µ—Ä—É –æ“£–∞–π—ã—Ä–∞“õ –±–æ–ª–∞–¥—ã.
            </p>
          </div>

          <div class="panel" style="margin-top:12px">
            <h3>–ï—Ä—É —Ç—É—Ä–∞–ª—ã “õ—ã—Å“õ–∞ –µ—Ä–µ–∂–µ</h3>
            <p class="muted" style="margin:0">
              ¬´“∞“õ—Å–∞—Å “±“õ—Å–∞—Å—Ç–∞ –µ—Ä–∏–¥—ñ¬ª: –ø–æ–ª—è—Ä–ª—ã –∑–∞—Ç—Ç–∞—Ä –ø–æ–ª—è—Ä–ª—ã –µ—Ä—ñ—Ç–∫—ñ—à—Ç–µ (—Å—É) –∂–∞“õ—Å—ã –µ—Ä–∏–¥—ñ.
            </p>
          </div>
        </div>

        <div class="card">
          <h2>–°–∏–º—É–ª—è—Ü–∏—è–ª—ã“õ —Ç–∞–ø—Å—ã—Ä–º–∞ (–º–æ–¥–µ–ª—å)</h2>
          <p class="muted">–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥—ñ ”©–∑–≥–µ—Ä—Ç—ñ“£—ñ–∑: –µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã –º–µ–Ω –∫”©—Ä—ñ–Ω—ñ—Å—ñ ”©–∑–≥–µ—Ä–µ–¥—ñ.</p>

          <div class="lab">
            <div>
              <label class="small">–ï—Ä–∏—Ç—ñ–Ω –∑–∞—Ç —Ç“Ø—Ä—ñ</label>
              <select id="soluteType">
                <option value="ionic">–ò–æ–Ω–¥—ã“õ (–º—ã—Å: NaCl)</option>
                <option value="polar">–ü–æ–ª—è—Ä–ª—ã –º–æ–ª–µ–∫—É–ª–∞–ª—ã“õ (–º—ã—Å: “õ–∞–Ω—Ç)</option>
                <option value="nonpolar">–ë–µ–π–ø–æ–ª—è—Ä–ª—ã (–º—ã—Å: –º–∞–π)</option>
              </select>

              <div class="row" style="margin-top:10px">
                <div style="flex:1 1 220px">
                  <label class="small">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</label>
                  <input id="temp" type="range" min="0" max="90" value="25" />
                  <div class="muted" style="font-size:12px;margin-top:6px">T: <span class="mono" id="tempVal">25</span>¬∞C</div>
                </div>
                <div style="flex:1 1 220px">
                  <label class="small">“∞–Ω—Ç–∞“õ—Ç–∞–ª—É—ã (–±–µ—Ç –∞—É–¥–∞–Ω—ã)</label>
                  <input id="surface" type="range" min="0" max="100" value="50" />
                  <div class="muted" style="font-size:12px;margin-top:6px">–ë–µ—Ç –∞—É–¥–∞–Ω—ã: <span class="mono" id="surfaceVal">50</span>/100</div>
                </div>
              </div>

              <div class="row" style="margin-top:10px">
                <div style="flex:1 1 220px">
                  <label class="small">–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É</label>
                  <select id="stirSelect">
                    <option value="0">–ñ–æ“õ</option>
                    <option value="1">–û—Ä—Ç–∞—à–∞</option>
                    <option value="2">–ö“Ø—à—Ç—ñ</option>
                  </select>
                </div>
                <div style="flex:1 1 220px">
                  <label class="small">–¢“±–∑–∞“õ (“õ–∞–Ω—ã“ì—É) —ç—Ñ—Ñ–µ–∫—Ç—ñ</label>
                  <select id="satSelect">
                    <option value="0">–ñ–æ“õ (–∂–µ“£—ñ–ª)</option>
                    <option value="1">–ë–∞—Ä (–Ω–∞“õ—Ç—ã—Ä–∞“õ)</option>
                  </select>
                </div>
              </div>

              <div class="row" style="margin-top:12px">
                <button class="primary" id="startSim">–ï—Ä—É–¥—ñ –±–∞—Å—Ç–∞—É</button>
                <button class="ghost" id="resetSim">–¢–∞–∑–∞–ª–∞—É</button>
              </div>

              <div class="result" id="simResult">
                <span class="muted">–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ –¥–∞, ¬´–ï—Ä—É–¥—ñ –±–∞—Å—Ç–∞—É¬ª –±–∞—Å—ã“£—ã–∑.</span>
              </div>
            </div>

            <div>
              <div class="beaker" id="beaker">
                <!-- Beaker SVG -->
                <svg viewBox="0 0 520 300" aria-hidden="true">
                  <defs>
                    <linearGradient id="water" x1="0" x2="0" y1="0" y2="1">
                      <stop offset="0" stop-color="rgba(69,214,255,.18)"/>
                      <stop offset="1" stop-color="rgba(69,214,255,.06)"/>
                    </linearGradient>
                    <linearGradient id="glass" x1="0" x2="1">
                      <stop offset="0" stop-color="rgba(255,255,255,.10)"/>
                      <stop offset="1" stop-color="rgba(255,255,255,.03)"/>
                    </linearGradient>
                  </defs>
                  <!-- glass -->
                  <path d="M150 30 h220 v20 l-25 200 q-2 20-20 20 H195 q-18 0-20-20 L150 50 Z"
                        fill="url(#glass)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
                  <!-- water -->
                  <path id="waterShape" d="M172 100 h176 l-18 145 q-2 14-14 14 H204 q-12 0-14-14 L172 100 Z"
                        fill="url(#water)" stroke="rgba(255,255,255,.10)" stroke-width="1"/>
                  <!-- surface line -->
                  <path d="M172 100 h176" stroke="rgba(255,255,255,.18)" stroke-width="2" opacity=".6"/>
                  <!-- thermometer hint -->
                  <g opacity=".5">
                    <rect x="395" y="70" width="22" height="150" rx="10" fill="rgba(255,255,255,.05)" stroke="rgba(255,255,255,.12)"/>
                    <circle cx="406" cy="230" r="16" fill="rgba(255,255,255,.05)" stroke="rgba(255,255,255,.12)"/>
                  </g>
                </svg>

                <div class="cloud" id="cloud" aria-hidden="true"></div>
                <div class="stir" id="stir" aria-hidden="true"></div>
              </div>

              <div class="panel" style="margin-top:12px">
                <h3>–®—ã“ì—ã—Å –∫”©—Ä—Å–µ—Ç–∫—ñ—à—Ç–µ—Ä—ñ (–º–æ–¥–µ–ª—å)</h3>
                <div class="muted" style="font-size:12px">–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã</div>
                <div class="bar"><div class="fill" id="speedBar"></div></div>
                <div class="muted" style="font-size:12px;margin-top:8px">
                  –ë–æ–ª–∂–∞–º: <span class="mono" id="speedText">‚Äî</span>
                </div>
              </div>

            </div>
          </div>

        </div>
      </div>

      <div class="footer">–ï—Å–∫–µ—Ä—Ç—É: –ë“±–ª ‚Äî –æ“õ—É —Å–∏–º—É–ª—è—Ü–∏—è—Å—ã (“õ–∞—Ç–∞“£ “ì—ã–ª—ã–º–∏ –µ—Å–µ–ø—Ç–µ—É –µ–º–µ—Å).</div>
    </section>

    <!-- ===== 2) TRUE/FALSE ===== -->
    <section id="page-tf" class="page">
      <div class="card">
        <h2>–®—ã–Ω–¥—ã“õ / –ñ–∞–ª“ì–∞–Ω</h2>
        <p class="muted">”ò—Ä —Ç“±–∂—ã—Ä—ã–º“ì–∞ –∂–∞—É–∞–ø –±–µ—Ä—ñ“£—ñ–∑. ‚Äú–¢–µ–∫—Å–µ—Ä—É‚Äù –±–∞—Å“õ–∞–Ω–¥–∞ –±—ñ—Ä–¥–µ–Ω –Ω”ô—Ç–∏–∂–µ —à—ã“ì–∞–¥—ã.</p>

        <div id="tfRoot"></div>

        <div class="row" style="margin-top:10px">
          <button class="primary" id="tfGrade">–ñ–∞–ª–ø—ã –Ω”ô—Ç–∏–∂–µ–Ω—ñ —à—ã“ì–∞—Ä—É</button>
          <button id="tfReset">“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
        </div>
        <div class="result" id="tfResult"></div>
      </div>
    </section>

    <!-- ===== 3) RACE ===== -->
    <section id="page-race" class="page">
      <div class="card">
        <h2>–ë”ô–π–≥–µ (–∞—Ç –∂–∞—Ä—ã—Å—ã) ‚Äî 4 —Ç–æ–ø</h2>
        <p class="muted">
          ”ò—Ä —Ç–æ–ø“õ–∞ –±—ñ—Ä –∞—Ç. –°“±—Ä–∞“õ—Ç–∞—Ä <b>–±—ñ—Ä-–±—ñ—Ä–¥–µ–Ω</b> —à—ã“ì–∞–¥—ã. –î“±—Ä—ã—Å –∂–∞—É–∞–ø –±–µ—Ä—Å–µ ‚Äî –∞—Ç <b>–±—ñ—Ä “õ–∞–¥–∞–º</b> –∞–ª“ì–∞ –∂—ã–ª–∂–∏–¥—ã.
          –ù”ô—Ç–∏–∂–µ –±—ñ—Ä–¥–µ–Ω –∫”©—Ä—Å–µ—Ç—ñ–ª–µ–¥—ñ.
        </p>

        <div class="raceTop">
          <div class="track">
            <div class="lanes" id="lanes"></div>
          </div>

          <div class="raceHUD">
            <div class="row">
              <span class="pill">‚è±Ô∏è <span class="mono" id="raceTime">00:00</span></span>
              <span class="pill">üèÅ “ö–∞–¥–∞–º: <span class="mono">1 –¥“±—Ä—ã—Å –∂–∞—É–∞–ø = +1</span></span>
            </div>
            <div class="row">
              <button class="primary" id="raceStart">–ë–∞—Å—Ç–∞—É</button>
              <button class="danger" id="raceReset">“ö–∞–π—Ç–∞ –±–∞—Å—Ç–∞—É</button>
            </div>
          </div>

          <div class="result" id="raceStatus">
            <span class="warn">–ù“±—Å“õ–∞—É:</span> ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å—ã“£—ã–∑. ”ò—Ä —Ç–æ–ø ”©–∑ —Å“±—Ä–∞“ì—ã–Ω–∞ –∂–∞—É–∞–ø –±–µ—Ä–µ–¥—ñ.
          </div>
        </div>

        <div class="raceGrid" id="raceGrid"></div>

        <div class="footer">“∞–ø–∞–π/–∂—ã–ª–∂—É ‚Äî —Ç–µ–∫ –¥“±—Ä—ã—Å –∂–∞—É–∞–ø “Ø—à—ñ–Ω. –ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ –±—ñ—Ç–∫–µ–Ω–¥–µ –Ω–µ–º–µ—Å–µ –º”ô—Ä–µ–≥–µ –∂–µ—Ç–∫–µ–Ω–¥–µ –∂–µ“£—ñ–º–ø–∞–∑ –∞–Ω—ã“õ—Ç–∞–ª–∞–¥—ã.</div>
      </div>
    </section>

  </main>

  <script>
    /* ================== NAV ================== */
    const tabs = Array.from(document.querySelectorAll(".tab"));
    const pages = {
      sim: document.getElementById("page-sim"),
      tf: document.getElementById("page-tf"),
      race: document.getElementById("page-race"),
    };
    function setActive(key){
      Object.entries(pages).forEach(([k,el])=>el.classList.toggle("active", k===key));
      tabs.forEach(t=>t.classList.toggle("active", t.dataset.page===key));
    }
    function route(){
      const key = (location.hash || "#sim").replace("#","");
      setActive(pages[key] ? key : "sim");
    }
    window.addEventListener("hashchange", route);
    route();

    /* ================== 1) SIMULATION ================== */
    const soluteType = document.getElementById("soluteType");
    const temp = document.getElementById("temp");
    const surface = document.getElementById("surface");
    const stirSelect = document.getElementById("stirSelect");
    const satSelect = document.getElementById("satSelect");

    const tempVal = document.getElementById("tempVal");
    const surfaceVal = document.getElementById("surfaceVal");
    const startSim = document.getElementById("startSim");
    const resetSim = document.getElementById("resetSim");

    const beaker = document.getElementById("beaker");
    const cloud = document.getElementById("cloud");
    const stir = document.getElementById("stir");
    const speedBar = document.getElementById("speedBar");
    const speedText = document.getElementById("speedText");
    const simResult = document.getElementById("simResult");

    let dots = [];
    let simTimer = null;
    let simProgress = 0;

    function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

    function updateSimLabels(){
      tempVal.textContent = temp.value;
      surfaceVal.textContent = surface.value;
      renderSimPrediction();
    }

    function soluteBase(type){
      // 0..100: —Å—É“ì–∞ –∂–∞“õ—ã–Ω–¥—ã“ì—ã
      if(type==="ionic") return 80;
      if(type==="polar") return 70;
      return 20; // nonpolar
    }

    function computeSpeed(){
      const base = soluteBase(soluteType.value);          // —Ç–∞–±–∏“ì–∞—Ç
      const T = Number(temp.value);                      // 0..90
      const S = Number(surface.value);                   // 0..100
      const stirLvl = Number(stirSelect.value);          // 0,1,2
      const sat = Number(satSelect.value);               // 0/1

      // —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ”ô—Å–µ—Ä—ñ: –±–µ–π–ø–æ–ª—è—Ä–ª—ã–¥–∞ –¥–∞ –∞–∑–¥–∞–ø ”©—Å–µ–¥—ñ, –±—ñ—Ä–∞“õ –±–∞–∑–∞ —Ç”©–º–µ–Ω
      const tempBoost = (T/90)*30;

      // –±–µ—Ç –∞—É–¥–∞–Ω—ã: 0..25
      const surfaceBoost = (S/100)*25;

      // –∞—Ä–∞–ª–∞—Å—Ç—ã—Ä—É: 0..20
      const stirBoost = stirLvl*10;

      // “õ–∞–Ω—ã“ì—É —ç—Ñ—Ñ–µ–∫—Ç—ñ: —à–µ–∫—Ç–µ—É (—Ä–µ–∞–ª–∏—Å—Ç—ñ–∫) ‚Äî –∂–æ“ì–∞—Ä—ã –±–∞–∑–∞ –±–æ–ª—Å–∞, –∂—ã–ª–¥–∞–º–¥—ã“õ ‚Äú—Ç”©–º–µ–Ω–¥–µ–π‚Äù –±–∞—Å—Ç–∞–π–¥—ã
      let speed = base*0.55 + tempBoost + surfaceBoost + stirBoost;

      if(sat===1){
        // “õ–∞–Ω—ã“õ“õ–∞–Ω —Å–∞–π—ã–Ω –±–∞—è—É–ª–∞—É: speed —Ç—ã–º –∂–æ“ì–∞—Ä—ã –±–æ–ª—Å–∞, –∞–∑–¥–∞–ø –∫–µ—Å—É
        speed = speed - Math.max(0, speed-75)*0.6;
      }

      return clamp(Math.round(speed), 0, 100);
    }

    function labelSpeed(v){
      if(v>=80) return "”®—Ç–µ –∂—ã–ª–¥–∞–º";
      if(v>=60) return "–ñ—ã–ª–¥–∞–º";
      if(v>=40) return "–û—Ä—Ç–∞—à–∞";
      if(v>=20) return "–ë–∞—è—É";
      return "”®—Ç–µ –±–∞—è—É / –Ω–∞—à–∞—Ä –µ—Ä–∏–¥—ñ";
    }

    function renderSimPrediction(){
      const sp = computeSpeed();
      speedBar.style.width = sp + "%";
      speedText.textContent = `${labelSpeed(sp)} (${sp}%)`;

      // visuals hints
      const st = Number(stirSelect.value);
      stir.style.opacity = st>0 ? "1" : "0";
      stir.style.animationDuration = st===2 ? "1.2s" : "2.2s";

      // cloud appears if dissolving is happening
      cloud.style.opacity = (soluteType.value==="nonpolar") ? "0.05" : "0.35";
    }

    function clearDots(){
      dots.forEach(d=>d.remove());
      dots = [];
    }

    function spawnDots(count){
      clearDots();
      // place dots near top water line and sink down a bit
      for(let i=0;i<count;i++){
        const d = document.createElement("div");
        d.className = "soluteDot";
        // beaker relative placement roughly inside water
        const x = 35 + Math.random()*30;     // %
        const y = 33 + Math.random()*10;     // %
        d.style.left = x + "%";
        d.style.top = y + "%";

        // color by type
        const type = soluteType.value;
        if(type==="ionic"){
          d.style.background = "rgba(69,214,255,.22)";
          d.style.borderColor = "rgba(69,214,255,.45)";
        }else if(type==="polar"){
          d.style.background = "rgba(123,255,178,.18)";
          d.style.borderColor = "rgba(123,255,178,.38)";
        }else{
          d.style.background = "rgba(255,209,102,.16)";
          d.style.borderColor = "rgba(255,209,102,.30)";
        }

        beaker.appendChild(d);
        dots.push(d);
      }
    }

    function simStep(){
      const sp = computeSpeed(); // 0..100
      // progress increment depends on speed
      const inc = (sp/100) * 0.06 + 0.01; // per tick
      simProgress = clamp(simProgress + inc, 0, 1);

      // dots fade out as they "dissolve"
      const dissolveCount = Math.floor(simProgress * dots.length);
      dots.forEach((d, idx)=>{
        if(idx < dissolveCount){
          d.style.opacity = "0";
          d.style.transform = "translate(-50%,-50%) scale(0.6)";
        }else{
          // swirl a bit if stirring
          const st = Number(stirSelect.value);
          if(st>0){
            const jitter = (st===2 ? 5 : 3);
            d.style.transform = `translate(-50%,-50%) translate(${(Math.random()*jitter-jitter/2).toFixed(1)}px, ${(Math.random()*jitter-jitter/2).toFixed(1)}px)`;
          }
        }
      });

      // ‚Äúcloud‚Äù intensity with progress for ionic/polar, very low for nonpolar
      if(soluteType.value==="nonpolar"){
        cloud.style.opacity = 0.08 + simProgress*0.12;
      }else{
        cloud.style.opacity = 0.18 + simProgress*0.45;
      }

      if(simProgress >= 1){
        clearInterval(simTimer);
        simTimer = null;

        const type = soluteType.value;
        let note = "";
        if(type==="nonpolar"){
          note = "–ë–µ–π–ø–æ–ª—è—Ä–ª—ã –∑–∞—Ç —Å—É“ì–∞ –Ω–∞—à–∞—Ä –µ—Ä–∏–¥—ñ: –∫”©–±—ñ–Ω–µ –±”©–ª–µ–∫ “õ–∞–±–∞—Ç —Ç“Ø–∑—É—ñ –º“Ø–º–∫—ñ–Ω.";
        }else if(type==="ionic"){
          note = "–ò–æ–Ω–¥—ã“õ –∑–∞—Ç—Ç–∞—Ä —Å—É–¥a –∏–æ–Ω–¥–∞—Ä“ì–∞ –¥–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è–ª–∞–Ω—ã–ø, –≥–∏–¥—Ä–∞—Ç–∞—Ü–∏—è–ª–∞–Ω–∞–¥—ã ‚Äî ”ô–¥–µ—Ç—Ç–µ –∂–∞“õ—Å—ã –µ—Ä–∏–¥—ñ.";
        }else{
          note = "–ü–æ–ª—è—Ä–ª—ã –º–æ–ª–µ–∫—É–ª–∞–ª–∞—Ä —Å—É –º–æ–ª–µ–∫—É–ª–∞–ª–∞—Ä—ã–º–µ–Ω —Å—É—Ç–µ–∫—Ç—ñ–∫/–¥–∏–ø–æ–ª—å-–¥–∏–ø–æ–ª—å ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å—ñ–ø –µ—Ä–∏–¥—ñ.";
        }

        simResult.innerHTML = `<span class="ok">–°–∏–º—É–ª—è—Ü–∏—è –∞—è“õ—Ç–∞–ª–¥—ã ‚úÖ</span><br><span class="muted">${note}</span>`;
      }
    }

    function startSimulation(){
      if(simTimer) return;
      simProgress = 0;

      const sp = computeSpeed();
      // dots count depends on speed & surface
      const count = clamp(Math.round(18 + (Number(surface.value)/100)*22), 18, 45);
      spawnDots(count);

      simResult.innerHTML = `<span class="muted">–ï—Ä—É –∂“Ø—Ä—ñ–ø –∂–∞—Ç—ã—Ä‚Ä¶</span> –ë–æ–ª–∂–∞–º –∂—ã–ª–¥–∞–º–¥—ã“õ: <b>${labelSpeed(sp)}</b> (${sp}%).`;

      // show stir ring depending on stirring
      renderSimPrediction();

      simTimer = setInterval(simStep, 120);
    }

    function resetSimulation(){
      if(simTimer){ clearInterval(simTimer); simTimer=null; }
      simProgress = 0;
      clearDots();
      cloud.style.opacity = "0";
      stir.style.opacity = "0";
      speedBar.style.width = "0%";
      speedText.textContent = "‚Äî";
      simResult.innerHTML = `<span class="muted">–ü–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ –¥–∞, ¬´–ï—Ä—É–¥—ñ –±–∞—Å—Ç–∞—É¬ª –±–∞—Å—ã“£—ã–∑.</span>`;
      renderSimPrediction();
    }

    [soluteType,temp,surface,stirSelect,satSelect].forEach(el=>el.addEventListener("input", updateSimLabels));
    [soluteType,stirSelect,satSelect].forEach(el=>el.addEventListener("change", updateSimLabels));
    startSim.addEventListener("click", startSimulation);
    resetSim.addEventListener("click", resetSimulation);
    updateSimLabels();

    /* ================== 2) TRUE/FALSE ================== */
    const tfData = [
      { s:"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–Ω—ã –∞—Ä—Ç—Ç—ã—Ä—É –∫”©–ø—Ç–µ–≥–µ–Ω “õ–∞—Ç—Ç—ã –∑–∞—Ç—Ç–∞—Ä–¥—ã“£ —Å—É–¥–∞ –µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω –∞—Ä—Ç—Ç—ã—Ä–∞–¥—ã.", a:true },
      { s:"“∞–Ω—Ç–∞“õ—Ç–∞—É (–±–µ—Ç –∞—É–¥–∞–Ω—ã–Ω “Ø–ª–∫–µ–π—Ç—É) –µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω–∞ ”ô—Å–µ—Ä –µ—Ç–ø–µ–π–¥—ñ.", a:false },
      { s:"–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ–¥–µ–≥—ñ –∑–∞—Ç—Ç—ã“£ —Ç–∞—Ä–∞–ª—É—ã–Ω –∂—ã–ª–¥–∞–º–¥–∞—Ç—ã–ø, –µ—Ä—É–¥—ñ —Ç–µ–∑–¥–µ—Ç—É—ñ –º“Ø–º–∫—ñ–Ω.", a:true },
      { s:"–ë–µ–π–ø–æ–ª—è—Ä–ª—ã –∑–∞—Ç—Ç–∞—Ä (–º–∞–π —Ç”ô—Ä—ñ–∑–¥—ñ) —Å—É“ì–∞ –∫”©–±—ñ–Ω–µ –Ω–∞—à–∞—Ä –µ—Ä–∏–¥—ñ.", a:true },
      { s:"–ï—Ä—É ‚Äî ”ô—Ä“õ–∞—à–∞–Ω —Ö–∏–º–∏—è–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è, —Ñ–∏–∑–∏–∫–∞–ª—ã“õ –ø—Ä–æ—Ü–µ—Å—Å –±–æ–ª–º–∞–π–¥—ã.", a:false },
      { s:"“ö–∞–Ω—ã“õ“õ–∞–Ω –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ–¥–µ “õ–æ—Å—ã–º—à–∞ –∑–∞—Ç—Ç—ã“£ –µ—Ä—É—ñ –±–∞—è—É–ª–∞–π–¥—ã –Ω–µ–º–µ—Å–µ —Ç–æ“õ—Ç–∞–π–¥—ã.", a:true },
      { s:"‚Äú“∞“õ—Å–∞—Å “±“õ—Å–∞—Å—Ç–∞ –µ—Ä–∏–¥—ñ‚Äù –µ—Ä–µ–∂–µ—Å—ñ –ø–æ–ª—è—Ä–ª—ã“õ“õ–∞ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã.", a:true },
      { s:"–ò–æ–Ω–¥—ã“õ –∑–∞—Ç—Ç–∞—Ä —Å—É–¥–∞ –µ—Ä—ñ–≥–µ–Ω–¥–µ –∏–æ–Ω–¥–∞—Ä“ì–∞ –¥–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è–ª–∞–Ω—É—ã –º“Ø–º–∫—ñ–Ω.", a:true }
    ];

    const tfRoot = document.getElementById("tfRoot");
    const tfGrade = document.getElementById("tfGrade");
    const tfReset = document.getElementById("tfReset");
    const tfResult = document.getElementById("tfResult");

    function buildTF(){
      tfRoot.innerHTML = "";
      tfData.forEach((item,i)=>{
        const id = `tf${i}`;
        const div = document.createElement("div");
        div.className = "tf-item";
        div.innerHTML = `
          <div class="tf-head">
            <div class="num">${i+1}</div>
            <div style="flex:1 1 auto">
              <div style="font-size:13px; line-height:1.35">${item.s}</div>
            </div>
            <span class="pill" id="${id}tag">‚Äî</span>
          </div>

          <div class="row" style="gap:8px">
            <label class="opt" style="margin:0">
              <input type="radio" name="${id}" value="true" />
              <span>–®—ã–Ω–¥—ã“õ</span>
            </label>
            <label class="opt" style="margin:0">
              <input type="radio" name="${id}" value="false" />
              <span>–ñ–∞–ª“ì–∞–Ω</span>
            </label>
            <button class="primary" data-tfcheck="${i}">–¢–µ–∫—Å–µ—Ä—É</button>
          </div>

          <div class="muted" id="${id}msg" style="margin-top:10px;font-size:12px">–ñ–∞—É–∞–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑.</div>
        `;
        tfRoot.appendChild(div);
      });

      tfRoot.querySelectorAll("button[data-tfcheck]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const i = Number(btn.dataset.tfcheck);
          const id = `tf${i}`;
          const sel = tfRoot.querySelector(`input[name="${id}"]:checked`);
          const tag = document.getElementById(id+"tag");
          const msg = document.getElementById(id+"msg");
          if(!sel){
            msg.innerHTML = `<span class="warn">–ï—Å–∫–µ—Ä—Ç—É:</span> –¢–∞“£–¥–∞–ª–º–∞“ì–∞–Ω.`;
            return;
          }
          const chosen = (sel.value === "true");
          const ok = chosen === tfData[i].a;

          tag.textContent = ok ? "–î“∞–†–´–°" : "“ö–ê–¢–ï";
          tag.style.borderColor = ok ? "rgba(46,247,161,.45)" : "rgba(255,77,109,.45)";
          tag.style.background = ok ? "rgba(46,247,161,.10)" : "rgba(255,77,109,.10)";
          msg.innerHTML = ok
            ? `<span class="ok">–î“±—Ä—ã—Å ‚úÖ</span>`
            : `<span class="bad">“ö–∞—Ç–µ ‚ùå</span> –î“±—Ä—ã—Å –∂–∞—É–∞–ø: <b>${tfData[i].a ? "–®—ã–Ω–¥—ã“õ" : "–ñ–∞–ª“ì–∞–Ω"}</b>.`;

          // lock
          tfRoot.querySelectorAll(`input[name="${id}"]`).forEach(inp=>inp.disabled=true);
          btn.disabled = true;
        });
      });

      tfResult.innerHTML = `<span class="muted">–ë–∞—Ä–ª—ã“ì—ã–Ω –æ—Ä—ã–Ω–¥–∞–ø, ¬´–ñ–∞–ª–ø—ã –Ω”ô—Ç–∏–∂–µ–Ω—ñ —à—ã“ì–∞—Ä—É¬ª –±–∞—Å—ã“£—ã–∑.</span>`;
    }

    tfGrade.addEventListener("click", ()=>{
      let correct = 0, answered = 0;
      tfData.forEach((item,i)=>{
        const sel = tfRoot.querySelector(`input[name="tf${i}"]:checked`);
        if(sel){
          answered++;
          if((sel.value==="true") === item.a) correct++;
        }
      });
      const total = tfData.length;
      const pct = Math.round((correct/total)*100);
      tfResult.innerHTML = `–ù”ô—Ç–∏–∂–µ: <b>${correct}/${total}</b> (${pct}%). ` +
        (answered<total ? `<span class="warn">(${total-answered} –∂–∞—É–∞–ø –∂–æ“õ)</span>` : `<span class="ok">–ñ–∞—É–∞–ø—Ç–∞—Ä–¥—ã“£ –±”ô—Ä—ñ –±–µ—Ä—ñ–ª–¥—ñ ‚úÖ</span>`);
    });
    tfReset.addEventListener("click", buildTF);
    buildTF();

    /* ================== 3) RACE (4 TEAMS) ================== */
    const lanesEl = document.getElementById("lanes");
    const raceGrid = document.getElementById("raceGrid");
    const raceStart = document.getElementById("raceStart");
    const raceReset = document.getElementById("raceReset");
    const raceTime = document.getElementById("raceTime");
    const raceStatus = document.getElementById("raceStatus");

    const TEAMS = [
      { key:"T1", name:"1-—Ç–æ–ø", icon:"üèá", colorA:"rgba(69,214,255,.22)" },
      { key:"T2", name:"2-—Ç–æ–ø", icon:"üêé", colorA:"rgba(123,255,178,.18)" },
      { key:"T3", name:"3-—Ç–æ–ø", icon:"üèá", colorA:"rgba(255,209,102,.16)" },
      { key:"T4", name:"4-—Ç–æ–ø", icon:"üêé", colorA:"rgba(255,77,109,.12)" },
    ];

    // Questions: dissolution topic (mix, not identical to TF)
    const raceQuestions = {
      T1: [
        { type:"mcq", q:"–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω –∞—Ä—Ç—Ç—ã—Ä–∞—Ç—ã–Ω ”ô—Ä–µ–∫–µ—Ç:", options:["“∞–Ω—Ç–∞“õ—Ç–∞—É","–°—É–¥—ã —Å–∞–ª“õ—ã–Ω–¥–∞—Ç—É","–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É–¥—ã —Ç–æ“õ—Ç–∞—Ç—É","–ë–µ—Ç –∞—É–¥–∞–Ω—ã–Ω –∞–∑–∞–π—Ç—É"], a:0 },
        { type:"mcq", q:"“ö–∞–Ω—Ç—Ç—ã“£ —Å—É–¥–∞ –µ—Ä—É—ñ –∫”©–±—ñ–Ω–µ “õ–∞–Ω–¥–∞–π ”ô—Ä–µ–∫–µ—Ç—Ç–µ—Å—É–ª–µ—Ä–≥–µ –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã?", options:["–î–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è","–°—É—Ç–µ–∫—Ç—ñ–∫ –±–∞–π–ª–∞–Ω—ã—Å/–¥–∏–ø–æ–ª—å-–¥–∏–ø–æ–ª—å","–ú–µ—Ç–∞–ª–¥—ã“õ –±–∞–π–ª–∞–Ω—ã—Å","–ò–æ–Ω–¥—ã“õ —Ç–æ—Ä"], a:1 },
        { type:"tf",  q:"“ö–∞–Ω—ã“õ“õ–∞–Ω –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ–¥–µ –∑–∞—Ç ”ô–ª—ñ –¥–µ —à–µ–∫—Å—ñ–∑ –µ—Ä–∏ –±–µ—Ä–µ–¥—ñ.", options:["–®—ã–Ω–¥—ã“õ","–ñ–∞–ª“ì–∞–Ω"], a:1 },
        { type:"mcq", q:"–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–Ω—ã –∫”©—Ç–µ—Ä–≥–µ–Ω–¥–µ –∫”©–ø “õ–∞—Ç—Ç—ã –∑–∞—Ç—Ç–∞—Ä–¥—ã“£ –µ—Ä—É—ñ:", options:["–ñ—ã–ª–¥–∞–º–¥–∞–π–¥—ã","”ò—Ä“õ–∞—à–∞–Ω —Ç–æ“õ—Ç–∞–π–¥—ã","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","–¢–µ–∫ –±–µ–π–ø–æ–ª—è—Ä–ª—ã–¥–∞ –±–æ–ª–∞–¥—ã"], a:0 },
        { type:"mcq", q:"–ï—Ä—É –∫–µ–∑—ñ–Ω–¥–µ –∑–∞—Ç –±”©–ª—à–µ–∫—Ç–µ—Ä—ñ —Å—É“ì–∞ —Ç–∞—Ä–∞–ª–∞–¥—ã ‚Äî –±“±–ª –∫”©–±—ñ–Ω–µ:", options:["–§–∏–∑–∏–∫–∞–ª—ã“õ –ø—Ä–æ—Ü–µ—Å—Å","–¢–µ–∫ —Ö–∏–º–∏—è–ª—ã“õ —Ä–µ–∞–∫—Ü–∏—è","–ñ–∞–Ω—É –ø—Ä–æ—Ü–µ—Å—ñ","–ë–∞–ª“õ—É “ì–∞–Ω–∞"], a:0 },
      ],
      T2: [
        { type:"mcq", q:"–ú–∞–π–¥—ã“£ —Å—É–¥–∞ –Ω–∞—à–∞—Ä –µ—Ä—É—ñ–Ω—ñ“£ –±–∞—Å—Ç—ã —Å–µ–±–µ–±—ñ:", options:["–ú–∞–π ”©—Ç–µ –∞—É—ã—Ä","–ú–∞–π –±–µ–π–ø–æ–ª—è—Ä–ª—ã, —Å—É –ø–æ–ª—è—Ä–ª—ã","–°—É “õ—ã—à“õ—ã–ª","–ú–∞–π –∏–æ–Ω–¥—ã“õ"], a:1 },
        { type:"mcq", q:"–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É–¥—ã“£ ”ô—Å–µ—Ä—ñ:", options:["–ï—Ä—É–¥—ñ –±–∞—è—É–ª–∞—Ç–∞–¥—ã","–ï—Ä—É–¥—ñ —Ç–µ–∑–¥–µ—Ç–µ–¥—ñ, —à–µ–∫–∞—Ä–∞ “õ–∞–±–∞—Ç—ã–Ω –∞–∑–∞–π—Ç–∞–¥—ã","–¢–µ–∫ –≥–∞–∑–¥–∞—Ä“ì–∞ ”ô—Å–µ—Ä –µ—Ç–µ–¥—ñ","–¢–µ–∫ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–Ω—ã ”©–∑–≥–µ—Ä—Ç–µ–¥—ñ"], a:1 },
        { type:"mcq", q:"–ï—Ä–∏—Ç—ñ–Ω –∑–∞—Ç—Ç—ã“£ –±–µ—Ç –∞—É–¥–∞–Ω—ã –∞—Ä—Ç—Å–∞:", options:["–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã –∞—Ä—Ç–∞–¥—ã","–ï—Ä—É —Ç–æ“õ—Ç–∞–π–¥—ã","–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã —Ç”©–º–µ–Ω–¥–µ–π–¥—ñ","–¢–µ–∫ –∏–æ–Ω–¥—ã“õ—Ç–∞ –±–æ–ª–∞–¥—ã"], a:0 },
        { type:"tf",  q:"–ò–æ–Ω–¥—ã“õ –∑–∞—Ç—Ç–∞—Ä —Å—É–¥–∞ –µ—Ä—ñ–≥–µ–Ω–¥–µ –∏–æ–Ω–¥–∞—Ä“ì–∞ –±”©–ª—ñ–Ω—É—ñ –º“Ø–º–∫—ñ–Ω.", options:["–®—ã–Ω–¥—ã“õ","–ñ–∞–ª“ì–∞–Ω"], a:0 },
        { type:"mcq", q:"‚Äú“∞“õ—Å–∞—Å “±“õ—Å–∞—Å—Ç–∞ –µ—Ä–∏–¥—ñ‚Äù “õ–∞“ì–∏–¥–∞—Å—ã –Ω–µ–≥—ñ–∑—ñ–Ω–µ–Ω:", options:["–¢“Ø—Å–∫–µ","–ü–æ–ª—è—Ä–ª—ã“õ“õ–∞","–¢—ã“ì—ã–∑–¥—ã“õ“õ–∞","–ñ—ã–ª—Ç—ã—Ä“ì–∞"], a:1 },
      ],
      T3: [
        { type:"mcq", q:"–ï—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã–Ω–∞ ”ô—Å–µ—Ä –µ—Ç–ø–µ–π—Ç—ñ–Ω —Ñ–∞–∫—Ç–æ—Ä —Ä–µ—Ç—ñ–Ω–¥–µ “õ–∞–π—Å—ã—Å—ã –¥“±—Ä—ã—Å?", options:["–ó–∞—Ç —Ç–∞–±–∏“ì–∞—Ç—ã","–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞","–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É","–ó–∞—Ç—Ç—ã“£ —Ç“Ø—Å—ñ (–∫”©–±—ñ–Ω–µ)"], a:3 },
        { type:"mcq", q:"“ö–∞—Ç—Ç—ã –∑–∞—Ç —Å—É–¥–∞ –µ—Ä—ñ–≥–µ–Ω–¥–µ –∂–∏—ñ –±–∞–π“õ–∞–ª–∞—Ç—ã–Ω “õ“±–±—ã–ª—ã—Å:", options:["–ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è","–ú–µ—Ç–∞–ª–¥–∞–Ω—É","–ö—Ä–∏—Å—Ç–∞–ª–¥–∞–Ω—É –±—ñ—Ä–¥–µ–Ω","–í–∞–∫—É—É–º"], a:0 },
        { type:"tf",  q:"–ï—Ä—ñ–≥—ñ—à—Ç—ñ–∫ –ø–µ–Ω –µ—Ä—É –∂—ã–ª–¥–∞–º–¥—ã“ì—ã –±—ñ—Ä –º–∞“ì—ã–Ω–∞, ”ô—Ä“õ–∞—à–∞–Ω —Ç–µ“£.", options:["–®—ã–Ω–¥—ã“õ","–ñ–∞–ª“ì–∞–Ω"], a:1 },
        { type:"mcq", q:"–ï—Ä—ñ–≥—ñ—à—Ç—ñ–∫ –¥–µ–≥–µ–Ω—ñ–º—ñ–∑:", options:["–ï—Ä—É–¥—ñ“£ –∂—ã–ª–¥–∞–º–¥—ã“ì—ã","–ë–µ–ª–≥—ñ–ª—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞–¥–∞ –µ—Ä–∏ –∞–ª–∞—Ç—ã–Ω –µ“£ –∫”©–ø –º”©–ª—à–µ—Ä","–°—É–¥—ã“£ –∫”©–ª–µ–º—ñ","–¢“Ø—Å—Ç—ñ“£ ”©–∑–≥–µ—Ä—É—ñ"], a:1 },
        { type:"mcq", q:"–ì–∞–∑–¥–∞—Ä–¥—ã“£ —Å—É–¥–∞ –µ—Ä—É—ñ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∞—Ä—Ç“õ–∞–Ω–¥–∞ –∫”©–±—ñ–Ω–µ:", options:["–ê—Ä—Ç–∞–¥—ã","–¢”©–º–µ–Ω–¥–µ–π–¥—ñ","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","”ò—Ä“õ–∞—à–∞–Ω –Ω”©–ª"], a:1 },
      ],
      T4: [
        { type:"mcq", q:"“ö–∞–Ω—Ç—Ç—ã –∂—ã–ª—ã —Å—É–¥–∞ –µ—Ä—ñ—Ç—Å–µ, —Å—É—ã“õ“õ–∞ “õ–∞—Ä–∞“ì–∞–Ω–¥–∞:", options:["–ë–∞—è—É –µ—Ä–∏–¥—ñ","–¢–µ–∑ –µ—Ä–∏–¥—ñ","–ï—à“õ–∞—à–∞–Ω –µ—Ä—ñ–º–µ–π–¥—ñ","–¢–µ–∫ —Ç“Ø—Å—ñ ”©–∑–≥–µ—Ä–µ–¥—ñ"], a:1 },
        { type:"tf",  q:"–ê—Ä–∞–ª–∞—Å—Ç—ã—Ä—É –µ—Ä—ñ—Ç—ñ–Ω–¥—ñ–Ω—ñ“£ –±—ñ—Ä–∫–µ–ª–∫—ñ –±–æ–ª—É—ã–Ω–∞ –∫”©–º–µ–∫—Ç–µ—Å–µ–¥—ñ.", options:["–®—ã–Ω–¥—ã“õ","–ñ–∞–ª“ì–∞–Ω"], a:0 },
        { type:"mcq", q:"–ï—Ä—É –±–∞—Ä—ã—Å—ã–Ω–¥–∞ –±”©–ª—à–µ–∫—Ç–µ—Ä–¥—ñ“£ —Å—É –º–æ–ª–µ–∫—É–ª–∞–ª–∞—Ä—ã–º–µ–Ω “õ–æ—Ä—à–∞–ª—É—ã:", options:["–ì–∏–¥—Ä–∞—Ç–∞—Ü–∏—è/—Å–æ–ª–≤–∞—Ç–∞—Ü–∏—è","–ë—É–ª–∞–Ω—É","–ö–æ–Ω–¥–µ–Ω—Å–∞—Ü–∏—è","–ö—Ä–∏—Å—Ç–∞–ª–¥–∞–Ω—É"], a:0 },
        { type:"mcq", q:"–ë–µ—Ç –∞—É–¥–∞–Ω—ã –∞–∑–∞–π—Å–∞ (—ñ—Ä—ñ —Ç“Ø–π—ñ—Ä), –µ—Ä—É:", options:["–ñ—ã–ª–¥–∞–º–¥–∞–π–¥—ã","–ë–∞—è—É–ª–∞–π–¥—ã","”®–∑–≥–µ—Ä–º–µ–π–¥—ñ","–¢–µ–∫ –≥–∞–∑“ì–∞ —Ç”ô–Ω"], a:1 },
        { type:"mcq", q:"–ï—Ä—ñ–≥—ñ—à—Ç—ñ–∫–∫–µ –µ“£ –∫“Ø—à—Ç—ñ ”ô—Å–µ—Ä –µ—Ç–µ—Ç—ñ–Ω–¥–µ—Ä–¥—ñ“£ –±—ñ—Ä—ñ:", options:["–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞","–î”ô–º","–ü—ñ—à—ñ–Ω","–ñ–∞—Ä—ã“õ"], a:0 },
      ],
    };

    const raceState = {
      started:false,
      startTime:null,
      timerId:null,
      step: 0,                 // finish steps
      pos: {T1:0, T2:0, T3:0, T4:0},
      idx: {T1:0, T2:0, T3:0, T4:0},
      locked: {T1:false, T2:false, T3:false, T4:false}, // locking while showing feedback
      done: {T1:false, T2:false, T3:false, T4:false},
      winner: null
    };

    const FINISH_STEPS = 6;          // after 6 correct answers, reach finish (but each team has 5 Q; so can win by reaching max Q correct + others)
    const MAX_STEPS = 6;
    const LEFT_MIN = 8;              // percent
    const LEFT_MAX = 78;             // percent

    function formatTime(ms){
      const sec = Math.floor(ms/1000);
      const m = String(Math.floor(sec/60)).padStart(2,"0");
      const s = String(sec%60).padStart(2,"0");
      return `${m}:${s}`;
    }
    function raceTick(){
      raceTime.textContent = formatTime(Date.now() - raceState.startTime);
    }

    function laneLeftForSteps(steps){
      // map 0..MAX_STEPS to LEFT_MIN..LEFT_MAX
      const t = steps / MAX_STEPS;
      return LEFT_MIN + t*(LEFT_MAX-LEFT_MIN);
    }

    function buildRaceUI(){
      // lanes
      lanesEl.innerHTML = "";
      TEAMS.forEach((t, i)=>{
        const lane = document.createElement("div");
        lane.className = "lane";
        lane.innerHTML = `
          <div class="finish" aria-hidden="true"></div>
          <div class="horse" id="horse-${t.key}" style="left:${laneLeftForSteps(0)}%">
            <div class="icon" style="background:${t.colorA}">${t.icon}</div>
            <div class="name"><b>${t.name}</b><br><span class="muted mono">“õ–∞–¥–∞–º: <span id="step-${t.key}">0</span></span></div>
          </div>
        `;
        lanesEl.appendChild(lane);
      });

      // question panels
      raceGrid.innerHTML = "";
      TEAMS.forEach(t=>{
        const box = document.createElement("div");
        box.className = "teamBox";
        box.id = `box-${t.key}`;
        box.innerHTML = `
          <div class="teamMeta">
            <h3>${t.icon} ${t.name}</h3>
            <span class="pill">–°“±—Ä–∞“õ: <span class="mono" id="qnum-${t.key}">1</span>/${raceQuestions[t.key].length}</span>
          </div>
          <div class="qArea">
            <p class="qText" id="qtext-${t.key}">‚Äî</p>
            <div class="choiceWrap" id="choices-${t.key}"></div>
            <div class="row" style="margin-top:10px;justify-content:space-between">
              <button class="primary" data-rcheck="${t.key}">–¢–µ–∫—Å–µ—Ä—É</button>
              <button class="ghost" data-rnext="${t.key}">–ö–µ–ª–µ—Å—ñ</button>
            </div>
            <div class="result" id="rmsg-${t.key}"><span class="muted">‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å“õ–∞–Ω–¥–∞ —Å“±—Ä–∞“õ —à—ã“ì–∞–¥—ã.</span></div>
          </div>
        `;
        raceGrid.appendChild(box);
      });
    }

    function setHorsePos(teamKey){
      const steps = raceState.pos[teamKey];
      const horse = document.getElementById(`horse-${teamKey}`);
      const stepEl = document.getElementById(`step-${teamKey}`);
      if(stepEl) stepEl.textContent = steps;
      if(horse) horse.style.left = laneLeftForSteps(steps) + "%";
    }

    function renderTeamQuestion(teamKey){
      const qs = raceQuestions[teamKey];
      const i = raceState.idx[teamKey];
      const q = qs[i];

      const qTextEl = document.getElementById(`qtext-${teamKey}`);
      const choicesEl = document.getElementById(`choices-${teamKey}`);
      const qNumEl = document.getElementById(`qnum-${teamKey}`);
      const msgEl = document.getElementById(`rmsg-${teamKey}`);

      if(raceState.done[teamKey]){
        qTextEl.textContent = "‚úÖ –ë“±–ª —Ç–æ–ø –±–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ—Ç—ã –∞—è“õ—Ç–∞–¥—ã.";
        choicesEl.innerHTML = "";
        msgEl.innerHTML = `<span class="ok">–ê—è“õ—Ç–∞–ª–¥—ã ‚úÖ</span>`;
        return;
      }

      qNumEl.textContent = (i+1);
      qTextEl.textContent = q.q;

      const name = `race-${teamKey}-q${i}`;
      choicesEl.innerHTML = q.options.map((opt, oi)=>`
        <label class="opt">
          <input type="radio" name="${name}" value="${oi}">
          <span>${opt}</span>
        </label>
      `).join("");

      msgEl.innerHTML = `<span class="muted">–ñ–∞—É–∞–ø—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑ –¥–∞ ‚Äú–¢–µ–∫—Å–µ—Ä—É‚Äù –±–∞—Å—ã“£—ã–∑.</span>`;
      raceState.locked[teamKey] = false;
      // enable inputs/buttons
      document.querySelectorAll(`#box-${teamKey} input`).forEach(inp=>inp.disabled=false);
      document.querySelectorAll(`#box-${teamKey} button`).forEach(b=>b.disabled=false);
    }

    function lockTeam(teamKey){
      document.querySelectorAll(`#box-${teamKey} input`).forEach(inp=>inp.disabled=true);
      // disable check only, allow next
      const checkBtn = document.querySelector(`#box-${teamKey} button[data-rcheck="${teamKey}"]`);
      if(checkBtn) checkBtn.disabled = true;
      raceState.locked[teamKey] = true;
    }

    function markRaceOptions(teamKey, correctIndex, chosenIndex){
      const box = document.getElementById(`box-${teamKey}`);
      const opts = Array.from(box.querySelectorAll(".opt"));
      opts.forEach(o=>{
        o.style.borderColor = "rgba(255,255,255,.10)";
        o.style.background = "rgba(255,255,255,.04)";
      });
      if(opts[correctIndex]){
        opts[correctIndex].style.borderColor = "rgba(46,247,161,.55)";
        opts[correctIndex].style.background = "rgba(46,247,161,.10)";
      }
      if(chosenIndex != null && chosenIndex !== correctIndex && opts[chosenIndex]){
        opts[chosenIndex].style.borderColor = "rgba(255,77,109,.55)";
        opts[chosenIndex].style.background = "rgba(255,77,109,.10)";
      }
    }

    function updateRaceStatus(){
      if(!raceState.started){
        raceStatus.innerHTML = `<span class="warn">–ù“±—Å“õ–∞—É:</span> ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å—ã“£—ã–∑. ”ò—Ä —Ç–æ–ø ”©–∑ —Å“±—Ä–∞“ì—ã–Ω–∞ –∂–∞—É–∞–ø –±–µ—Ä–µ–¥—ñ.`;
        return;
      }

      if(raceState.winner){
        raceStatus.innerHTML = `<span class="ok">üèÜ –ñ–µ“£—ñ–º–ø–∞–∑: ${raceState.winner}!</span> <span class="muted">(–£–∞“õ—ã—Ç: ${raceTime.textContent})</span>`;
        return;
      }

      const doneCount = Object.values(raceState.done).filter(Boolean).length;
      raceStatus.innerHTML =
        `–û–π—ã–Ω –∂“Ø—Ä—ñ–ø –∂–∞—Ç—ã—Ä‚Ä¶ <span class="muted">–ê—è“õ—Ç–∞“ì–∞–Ω —Ç–æ–ø—Ç–∞—Ä: ${doneCount}/4</span>. `+
        `–ú”ô—Ä–µ–≥–µ –∂–∞“õ—ã–Ω–¥–∞“ì–∞–Ω –∞—Ç—Ç–∞—Ä: `+
        `<span class="mono">T1=${raceState.pos.T1}, T2=${raceState.pos.T2}, T3=${raceState.pos.T3}, T4=${raceState.pos.T4}</span>`;
    }

    function maybeFinishRace(){
      // Winner rule:
      // 1) If any team reaches MAX_STEPS (finish), they win immediately.
      // 2) Else if all teams finished questions: highest steps wins; tie -> earliest finish by time not tracked per team here -> tie declared.
      const maxTeam = Object.entries(raceState.pos).sort((a,b)=>b[1]-a[1])[0];
      const [bestKey, bestSteps] = maxTeam;

      if(bestSteps >= MAX_STEPS){
        raceState.winner = TEAMS.find(t=>t.key===bestKey).name;
      } else {
        const allDone = Object.values(raceState.done).every(Boolean);
        if(allDone){
          // check ties
          const stepsArr = Object.values(raceState.pos);
          const max = Math.max(...stepsArr);
          const winners = Object.entries(raceState.pos).filter(([k,v])=>v===max).map(([k])=>k);
          if(winners.length===1){
            raceState.winner = TEAMS.find(t=>t.key===winners[0]).name;
          } else {
            raceState.winner = "–¢–ï“¢ (–±—ñ—Ä–Ω–µ—à–µ —Ç–æ–ø)";
          }
        }
      }

      if(raceState.winner){
        if(raceState.timerId){ clearInterval(raceState.timerId); raceState.timerId=null; }
      }
      updateRaceStatus();
    }

    function startRace(){
      if(raceState.started) return;
      raceState.started = true;
      raceState.startTime = Date.now();
      raceTime.textContent = "00:00";
      raceState.timerId = setInterval(raceTick, 250);

      // render first question for each team
      TEAMS.forEach(t=>renderTeamQuestion(t.key));
      updateRaceStatus();
    }

    function resetRace(){
      if(raceState.timerId){ clearInterval(raceState.timerId); raceState.timerId=null; }

      raceState.started=false;
      raceState.startTime=null;
      raceState.winner=null;

      TEAMS.forEach(t=>{
        raceState.pos[t.key]=0;
        raceState.idx[t.key]=0;
        raceState.locked[t.key]=false;
        raceState.done[t.key]=false;
      });

      raceTime.textContent = "00:00";
      buildRaceUI();
      TEAMS.forEach(t=>setHorsePos(t.key));
      updateRaceStatus();
    }

    function handleRaceCheck(teamKey){
      if(!raceState.started){
        raceStatus.innerHTML = `<span class="warn">–ê–ª–¥—ã–º–µ–Ω ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å—ã“£—ã–∑.</span>`;
        return;
      }
      if(raceState.winner) return;
      if(raceState.done[teamKey]) return;
      if(raceState.locked[teamKey]) return;

      const i = raceState.idx[teamKey];
      const q = raceQuestions[teamKey][i];
      const name = `race-${teamKey}-q${i}`;
      const sel = document.querySelector(`input[name="${name}"]:checked`);
      const msgEl = document.getElementById(`rmsg-${teamKey}`);

      if(!sel){
        msgEl.innerHTML = `<span class="warn">–ñ–∞—É–∞–ø —Ç–∞“£–¥–∞–ª–º–∞“ì–∞–Ω.</span>`;
        return;
      }

      const chosen = Number(sel.value);
      const correct = q.a;
      const ok = chosen === correct;

      markRaceOptions(teamKey, correct, chosen);

      if(ok){
        raceState.pos[teamKey] = clamp(raceState.pos[teamKey] + 1, 0, MAX_STEPS);
        setHorsePos(teamKey);
        msgEl.innerHTML = `<span class="ok">–î“±—Ä—ã—Å ‚úÖ</span> –ê—Ç 1 “õ–∞–¥–∞–º –∞–ª“ì–∞ –∂—ã–ª–∂—ã–¥—ã.`;
      }else{
        msgEl.innerHTML = `<span class="bad">“ö–∞—Ç–µ ‚ùå</span> –î“±—Ä—ã—Å –∂–∞—É–∞–ø –±–µ–ª–≥—ñ–ª–µ–Ω–¥—ñ.`;
      }

      lockTeam(teamKey);
      updateRaceStatus();
      maybeFinishRace();
    }

    function handleRaceNext(teamKey){
      if(!raceState.started){
        raceStatus.innerHTML = `<span class="warn">–ê–ª–¥—ã–º–µ–Ω ‚Äú–ë–∞—Å—Ç–∞—É‚Äù –±–∞—Å—ã“£—ã–∑.</span>`;
        return;
      }
      if(raceState.winner) return;
      if(raceState.done[teamKey]) return;

      // allow next even if not answered, but encourage answering
      const i = raceState.idx[teamKey];
      const msgEl = document.getElementById(`rmsg-${teamKey}`);
      const name = `race-${teamKey}-q${i}`;
      const sel = document.querySelector(`input[name="${name}"]:checked`);
      if(!sel && !raceState.locked[teamKey]){
        msgEl.innerHTML = `<span class="warn">–ê–ª–¥—ã–º–µ–Ω ‚Äú–¢–µ–∫—Å–µ—Ä—É‚Äù –∞—Ä“õ—ã–ª—ã –∂–∞—É–∞–ø –±–µ—Ä—ñ“£—ñ–∑.</span>`;
        return;
      }

      // move to next question
      raceState.idx[teamKey] += 1;
      if(raceState.idx[teamKey] >= raceQuestions[teamKey].length){
        raceState.done[teamKey] = true;
      }
      renderTeamQuestion(teamKey);
      updateRaceStatus();
      maybeFinishRace();
    }

    document.addEventListener("click", (e)=>{
      const c = e.target.closest("button[data-rcheck]");
      const n = e.target.closest("button[data-rnext]");
      if(c) handleRaceCheck(c.dataset.rcheck);
      if(n) handleRaceNext(n.dataset.rnext);
    });
    raceStart.addEventListener("click", startRace);
    raceReset.addEventListener("click", resetRace);

    // init race UI
    resetRace();
  </script>
</body>
</html>
